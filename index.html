<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dental Coach Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <script src="./edge-impulse-standalone.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: white; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #camera-container { position: relative; width: 90%; max-width: 400px; border-radius: 20px; overflow: hidden; border: 4px solid #333; }
        #webcam { width: 100%; transform: scaleX(-1); display: block; }
        #status-bar { width: 100%; padding: 20px; font-size: 24px; font-weight: bold; text-align: center; background: #222; }
        .correct { background: #28a745 !important; }
        .incorrect { background: #dc3545 !important; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        #start-btn { position: absolute; bottom: 30px; padding: 15px 40px; font-size: 18px; border-radius: 50px; border: none; background: #007bff; color: white; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <div id="status-bar">READY TO COACH</div>
    <div id="camera-container">
        <video id="webcam" playsinline autoplay muted></video>
    </div>
    <button id="start-btn" onclick="startCoach()">â–¶ START SESSION</button>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function buzz() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(400, audioCtx.currentTime);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
            osc.stop(audioCtx.currentTime + 0.6);
        }

        async function startCoach() {
            document.getElementById('start-btn').style.display = 'none';
            const status = document.getElementById('status-bar');
            status.innerText = "INITIALIZING...";
            
            try {
                if (typeof EdgeImpulseClassifier === 'undefined') throw new Error("AI Load Blocked");
                const classifier = new EdgeImpulseClassifier();
                await classifier.init();
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                document.getElementById('webcam').srcObject = stream;
                status.innerText = "WATCHING...";

                setInterval(async () => {
                    const res = await classifier.classify(document.getElementById('webcam'));
                    const top = res.results.reduce((a, b) => a.value > b.value ? a : b);
                    status.innerText = top.label.toUpperCase();
                    if(top.label.includes("incorrect") && top.value > 0.8) {
                        status.className = "incorrect";
                        buzz();
                    } else {
                        status.className = top.label.includes("correct") ? "correct" : "";
                    }
                }, 400);
            } catch (e) {
                status.innerText = "RELOAD IN INCOGNITO";
                console.error(e);
            }
        }
    </script>
</body>
</html>
